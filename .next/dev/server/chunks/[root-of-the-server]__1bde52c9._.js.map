{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 196, "column": 0}, "map": {"version":3,"sources":["file:///Users/rahmanbazarov/Data/programming/BedRock/src/lib/digital-presence-verification.ts"],"sourcesContent":["import { whoisDomain } from 'whoiser'\nimport * as cheerio from 'cheerio'\n\n// === Types ===\n\nexport interface DomainVerificationResult {\n  domainAge?: number\n  createdDate?: string\n  expiryDate?: string\n  registrar?: string\n  title?: string\n  description?: string\n  ogImage?: string\n  isLive: boolean\n  hasSSL: boolean\n  error?: string\n}\n\nexport interface TwitterVerificationResult {\n  handle: string\n  valid: boolean\n  profileUrl: string\n}\n\nexport interface InstagramVerificationResult {\n  handle: string\n  valid: boolean\n  profileUrl: string\n}\n\nexport interface AppStoreVerificationResult {\n  appName?: string\n  developer?: string\n  rating?: number\n  ratingCount?: number\n  price?: string\n  genre?: string\n  releaseDate?: string\n  iconUrl?: string\n  error?: string\n}\n\nexport type VerificationResult =\n  | { type: 'domain'; data: DomainVerificationResult }\n  | { type: 'twitter'; data: TwitterVerificationResult }\n  | { type: 'instagram'; data: InstagramVerificationResult }\n  | { type: 'appstore'; data: AppStoreVerificationResult }\n\n// === Domain Verification ===\n\nexport async function verifyDomain(url: string): Promise<DomainVerificationResult> {\n  let hostname: string\n  try {\n    const parsed = new URL(url.startsWith('http') ? url : `https://${url}`)\n    hostname = parsed.hostname\n  } catch {\n    return { isLive: false, hasSSL: false, error: 'Invalid URL format' }\n  }\n\n  const result: DomainVerificationResult = { isLive: false, hasSSL: false }\n\n  // WHOIS lookup\n  try {\n    const whoisData = await whoisDomain(hostname, { follow: 1, timeout: 5000 })\n    // whoiser returns an object keyed by registrar server\n    const firstKey = Object.keys(whoisData)[0]\n    const record = firstKey ? (whoisData as Record<string, Record<string, unknown>>)[firstKey] : null\n\n    if (record) {\n      const createdRaw = record['Created Date'] || record['Creation Date'] || record['created'] || record['Registration Date']\n      const expiryRaw = record['Expiry Date'] || record['Registry Expiry Date'] || record['expires'] || record['Expiration Date']\n      const registrarRaw = record['Registrar'] || record['registrar']\n\n      if (createdRaw) {\n        const createdStr = Array.isArray(createdRaw) ? String(createdRaw[0]) : String(createdRaw)\n        const createdDate = new Date(createdStr)\n        if (!isNaN(createdDate.getTime())) {\n          result.createdDate = createdDate.toISOString().split('T')[0]\n          const ageMs = Date.now() - createdDate.getTime()\n          result.domainAge = Math.round((ageMs / (1000 * 60 * 60 * 24 * 365)) * 10) / 10\n        }\n      }\n\n      if (expiryRaw) {\n        const expiryStr = Array.isArray(expiryRaw) ? String(expiryRaw[0]) : String(expiryRaw)\n        const expiryDate = new Date(expiryStr)\n        if (!isNaN(expiryDate.getTime())) {\n          result.expiryDate = expiryDate.toISOString().split('T')[0]\n        }\n      }\n\n      if (registrarRaw) {\n        result.registrar = Array.isArray(registrarRaw) ? String(registrarRaw[0]) : String(registrarRaw)\n      }\n    }\n  } catch {\n    // WHOIS may fail for some TLDs — continue with website fetch\n  }\n\n  // Website content fetch\n  try {\n    const fetchUrl = url.startsWith('http') ? url : `https://${url}`\n    result.hasSSL = fetchUrl.startsWith('https://')\n\n    const controller = new AbortController()\n    const timeout = setTimeout(() => controller.abort(), 5000)\n\n    const response = await fetch(fetchUrl, {\n      signal: controller.signal,\n      redirect: 'follow',\n      headers: {\n        'User-Agent': 'BedRock-Verifier/1.0',\n        'Accept': 'text/html',\n      },\n    })\n\n    clearTimeout(timeout)\n\n    if (response.ok) {\n      result.isLive = true\n      result.hasSSL = response.url.startsWith('https://')\n\n      const html = await response.text()\n      const $ = cheerio.load(html)\n\n      result.title = $('title').first().text().trim() || undefined\n      result.description =\n        $('meta[name=\"description\"]').attr('content')?.trim() ||\n        $('meta[property=\"og:description\"]').attr('content')?.trim() ||\n        undefined\n      result.ogImage =\n        $('meta[property=\"og:image\"]').attr('content')?.trim() ||\n        undefined\n    }\n  } catch {\n    // Site unreachable — isLive stays false\n  }\n\n  if (!result.isLive && !result.createdDate) {\n    result.error = 'Could not verify domain — site unreachable and WHOIS lookup failed'\n  }\n\n  return result\n}\n\n// === Twitter/X Verification ===\n\nexport function verifyTwitter(handle: string): TwitterVerificationResult {\n  // Normalize: strip @ and URL prefixes\n  let normalized = handle.trim()\n  normalized = normalized.replace(/^https?:\\/\\/(www\\.)?(twitter|x)\\.com\\//, '')\n  normalized = normalized.replace(/^@/, '')\n  normalized = normalized.split('/')[0] // remove trailing paths\n  normalized = normalized.split('?')[0] // remove query params\n\n  const valid = /^[a-zA-Z0-9_]{1,15}$/.test(normalized)\n\n  return {\n    handle: normalized,\n    valid,\n    profileUrl: `https://x.com/${normalized}`,\n  }\n}\n\n// === Instagram Verification ===\n\nexport function verifyInstagram(handle: string): InstagramVerificationResult {\n  let normalized = handle.trim()\n  normalized = normalized.replace(/^https?:\\/\\/(www\\.)?instagram\\.com\\//, '')\n  normalized = normalized.replace(/^@/, '')\n  normalized = normalized.split('/')[0]\n  normalized = normalized.split('?')[0]\n\n  const valid = /^[a-zA-Z0-9_.]{1,30}$/.test(normalized)\n\n  return {\n    handle: normalized,\n    valid,\n    profileUrl: `https://instagram.com/${normalized}`,\n  }\n}\n\n// === App Store Verification ===\n\nexport async function verifyAppStore(url: string): Promise<AppStoreVerificationResult> {\n  // Extract app ID from URL like apps.apple.com/.../id1234567890\n  const match = url.match(/id(\\d+)/)\n  if (!match) {\n    return { error: 'Could not find app ID in URL. Use a link like apps.apple.com/app/name/id123456789' }\n  }\n\n  const appId = match[1]\n\n  try {\n    const controller = new AbortController()\n    const timeout = setTimeout(() => controller.abort(), 5000)\n\n    const response = await fetch(\n      `https://itunes.apple.com/lookup?id=${appId}&country=us`,\n      { signal: controller.signal }\n    )\n\n    clearTimeout(timeout)\n\n    if (!response.ok) {\n      return { error: 'App Store lookup failed' }\n    }\n\n    const data = await response.json()\n\n    if (!data.results || data.results.length === 0) {\n      return { error: 'App not found in the App Store' }\n    }\n\n    const app = data.results[0]\n\n    return {\n      appName: app.trackName,\n      developer: app.artistName,\n      rating: app.averageUserRating ? Math.round(app.averageUserRating * 10) / 10 : undefined,\n      ratingCount: app.userRatingCount,\n      price: app.formattedPrice || (app.price === 0 ? 'Free' : `$${app.price}`),\n      genre: app.primaryGenreName,\n      releaseDate: app.releaseDate?.split('T')[0],\n      iconUrl: app.artworkUrl100,\n    }\n  } catch {\n    return { error: 'Could not reach App Store. Please try again.' }\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 370, "column": 0}, "map": {"version":3,"sources":["file:///Users/rahmanbazarov/Data/programming/BedRock/src/app/api/verify/digital-presence/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\nimport {\n  verifyDomain,\n  verifyTwitter,\n  verifyInstagram,\n  verifyAppStore,\n} from '@/lib/digital-presence-verification'\n\nexport async function POST(request: Request) {\n  try {\n    const { type, value } = await request.json()\n\n    if (!type || !value || typeof value !== 'string') {\n      return NextResponse.json(\n        { success: false, error: 'Missing type or value' },\n        { status: 400 }\n      )\n    }\n\n    switch (type) {\n      case 'domain': {\n        const data = await verifyDomain(value)\n        return NextResponse.json({ success: !data.error, data })\n      }\n      case 'twitter': {\n        const data = verifyTwitter(value)\n        return NextResponse.json({ success: data.valid, data })\n      }\n      case 'instagram': {\n        const data = verifyInstagram(value)\n        return NextResponse.json({ success: data.valid, data })\n      }\n      case 'appstore': {\n        const data = await verifyAppStore(value)\n        return NextResponse.json({ success: !data.error, data })\n      }\n      default:\n        return NextResponse.json(\n          { success: false, error: `Unknown verification type: ${type}` },\n          { status: 400 }\n        )\n    }\n  } catch {\n    return NextResponse.json(\n      { success: false, error: 'Verification failed' },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAOO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,QAAQ,IAAI;QAE1C,IAAI,CAAC,QAAQ,CAAC,SAAS,OAAO,UAAU,UAAU;YAChD,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAAwB,GACjD;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAQ;YACN,KAAK;gBAAU;oBACb,MAAM,OAAO,MAAM,IAAA,mKAAY,EAAC;oBAChC,OAAO,gJAAY,CAAC,IAAI,CAAC;wBAAE,SAAS,CAAC,KAAK,KAAK;wBAAE;oBAAK;gBACxD;YACA,KAAK;gBAAW;oBACd,MAAM,OAAO,IAAA,oKAAa,EAAC;oBAC3B,OAAO,gJAAY,CAAC,IAAI,CAAC;wBAAE,SAAS,KAAK,KAAK;wBAAE;oBAAK;gBACvD;YACA,KAAK;gBAAa;oBAChB,MAAM,OAAO,IAAA,sKAAe,EAAC;oBAC7B,OAAO,gJAAY,CAAC,IAAI,CAAC;wBAAE,SAAS,KAAK,KAAK;wBAAE;oBAAK;gBACvD;YACA,KAAK;gBAAY;oBACf,MAAM,OAAO,MAAM,IAAA,qKAAc,EAAC;oBAClC,OAAO,gJAAY,CAAC,IAAI,CAAC;wBAAE,SAAS,CAAC,KAAK,KAAK;wBAAE;oBAAK;gBACxD;YACA;gBACE,OAAO,gJAAY,CAAC,IAAI,CACtB;oBAAE,SAAS;oBAAO,OAAO,CAAC,2BAA2B,EAAE,MAAM;gBAAC,GAC9D;oBAAE,QAAQ;gBAAI;QAEpB;IACF,EAAE,OAAM;QACN,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO;QAAsB,GAC/C;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}