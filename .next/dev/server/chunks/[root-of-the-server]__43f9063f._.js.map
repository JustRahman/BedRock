{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/rahmanbazarov/Data/programming/BedRock/src/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr'\nimport { cookies } from 'next/headers'\nimport { Database } from '@/types/database'\n\nexport async function createClient() {\n  const cookieStore = await cookies()\n\n  return createServerClient<Database>(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return cookieStore.getAll()\n        },\n        setAll(cookiesToSet) {\n          try {\n            cookiesToSet.forEach(({ name, value, options }) =>\n              cookieStore.set(name, value, options)\n            )\n          } catch {\n            // The `setAll` method was called from a Server Component.\n            // This can be ignored if you have middleware refreshing\n            // user sessions.\n          }\n        },\n      },\n    }\n  )\n}\n\nexport async function createServiceClient() {\n  const cookieStore = await cookies()\n\n  return createServerClient<Database>(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.SUPABASE_SERVICE_ROLE_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return cookieStore.getAll()\n        },\n        setAll(cookiesToSet) {\n          try {\n            cookiesToSet.forEach(({ name, value, options }) =>\n              cookieStore.set(name, value, options)\n            )\n          } catch {\n            // Ignored in Server Components\n          }\n        },\n      },\n    }\n  )\n}\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;;;AAGO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IAEjC,OAAO,IAAA,iMAAkB,sUAGvB;QACE,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC5C,YAAY,GAAG,CAAC,MAAM,OAAO;gBAEjC,EAAE,OAAM;gBACN,0DAA0D;gBAC1D,wDAAwD;gBACxD,iBAAiB;gBACnB;YACF;QACF;IACF;AAEJ;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IAEjC,OAAO,IAAA,iMAAkB,gFAEvB,QAAQ,GAAG,CAAC,yBAAyB,EACrC;QACE,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC5C,YAAY,GAAG,CAAC,MAAM,OAAO;gBAEjC,EAAE,OAAM;gBACN,+BAA+B;gBACjC;YACF;QACF;IACF;AAEJ"}},
    {"offset": {"line": 97, "column": 0}, "map": {"version":3,"sources":["file:///Users/rahmanbazarov/Data/programming/BedRock/src/app/api/companies/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\nimport { createClient } from '@/lib/supabase/server'\n\ninterface FounderData {\n  id: string\n  role?: string\n}\n\nexport async function GET() {\n  try {\n    const supabase = await createClient()\n\n    const { data: { user }, error: userError } = await supabase.auth.getUser()\n    if (userError || !user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const { data: founderData } = await supabase\n      .from('founders')\n      .select('id')\n      .eq('user_id', user.id)\n      .single()\n\n    const founder = founderData as FounderData | null\n    if (!founder) {\n      return NextResponse.json({ error: 'Founder not found' }, { status: 404 })\n    }\n\n    const { data: company, error } = await supabase\n      .from('companies')\n      .select('*')\n      .eq('founder_id', founder.id)\n      .single()\n\n    if (error && error.code !== 'PGRST116') {\n      return NextResponse.json({ error: error.message }, { status: 500 })\n    }\n\n    return NextResponse.json({ company: company || null })\n  } catch {\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n\nexport async function POST(request: Request) {\n  try {\n    const supabase = await createClient()\n\n    const { data: { user }, error: userError } = await supabase.auth.getUser()\n    if (userError || !user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const { data: founderData } = await supabase\n      .from('founders')\n      .select('id')\n      .eq('user_id', user.id)\n      .single()\n\n    const founder = founderData as FounderData | null\n    if (!founder) {\n      return NextResponse.json({ error: 'Founder not found' }, { status: 404 })\n    }\n\n    const body = await request.json()\n\n    const insertData = {\n      founder_id: founder.id,\n      name: body.name,\n      legal_name: body.legalName || body.name,\n      state: body.state,\n      description: body.description || null,\n      formation_status: 'pending',\n    }\n\n    const { data: company, error } = await (supabase\n      .from('companies') as ReturnType<typeof supabase.from>)\n      .insert(insertData)\n      .select()\n      .single()\n\n    if (error) {\n      return NextResponse.json({ error: error.message }, { status: 500 })\n    }\n\n    const companyId = (company as { id: string }).id\n\n    // Auto-create compliance deadlines\n    const now = new Date()\n    const boiDue = new Date(now.getTime() + 90 * 24 * 60 * 60 * 1000)\n    const annualReportDue = new Date(now.getFullYear() + 1, 2, 1) // March 1 next year\n\n    await (supabase.from('compliance_deadlines') as ReturnType<typeof supabase.from>)\n      .insert([\n        {\n          founder_id: founder.id,\n          company_id: companyId,\n          title: 'FinCEN BOI Report',\n          description: 'Beneficial Ownership Information report due within 90 days of formation.',\n          due_date: boiDue.toISOString().split('T')[0],\n        },\n        {\n          founder_id: founder.id,\n          company_id: companyId,\n          title: `${body.state === 'DE' ? 'Delaware' : 'Wyoming'} Annual Report`,\n          description: `Annual report and franchise tax filing for ${body.state === 'DE' ? 'Delaware' : 'Wyoming'}.`,\n          due_date: annualReportDue.toISOString().split('T')[0],\n        },\n      ])\n\n    return NextResponse.json({ company }, { status: 201 })\n  } catch {\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n\nexport async function PATCH(request: Request) {\n  try {\n    const supabase = await createClient()\n\n    const { data: { user }, error: userError } = await supabase.auth.getUser()\n    if (userError || !user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const { data: founderData } = await supabase\n      .from('founders')\n      .select('id, role')\n      .eq('user_id', user.id)\n      .single()\n\n    const founder = founderData as FounderData | null\n    if (!founder) {\n      return NextResponse.json({ error: 'Founder not found' }, { status: 404 })\n    }\n\n    const body = await request.json()\n\n    const updateData: Record<string, unknown> = {}\n    if (body.formationStatus !== undefined) updateData.formation_status = body.formationStatus\n    if (body.ein !== undefined) updateData.ein = body.ein\n    if (body.formationDate !== undefined) updateData.formation_date = body.formationDate\n    if (body.name !== undefined) updateData.name = body.name\n    if (body.legalName !== undefined) updateData.legal_name = body.legalName\n\n    // Determine which company to update\n    const isAdmin = founder.role === 'admin' && body.companyId\n    let queryBuilder = (supabase.from('companies') as ReturnType<typeof supabase.from>)\n      .update(updateData)\n\n    queryBuilder = isAdmin\n      ? queryBuilder.eq('id', body.companyId)\n      : queryBuilder.eq('founder_id', founder.id)\n\n    const { data: company, error } = await queryBuilder\n      .select()\n      .single()\n\n    if (error) {\n      return NextResponse.json({ error: error.message }, { status: 500 })\n    }\n\n    return NextResponse.json({ company })\n  } catch {\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":"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"}}]
}