{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/rahmanbazarov/Data/programming/BedRock/src/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr'\nimport { createClient as createSupabaseClient } from '@supabase/supabase-js'\nimport { cookies } from 'next/headers'\nimport { Database } from '@/types/database'\n\nexport async function createClient() {\n  const cookieStore = await cookies()\n\n  return createServerClient<Database>(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return cookieStore.getAll()\n        },\n        setAll(cookiesToSet) {\n          try {\n            cookiesToSet.forEach(({ name, value, options }) =>\n              cookieStore.set(name, value, options)\n            )\n          } catch {\n            // The `setAll` method was called from a Server Component.\n            // This can be ignored if you have middleware refreshing\n            // user sessions.\n          }\n        },\n      },\n    }\n  )\n}\n\nexport function createServiceClient() {\n  return createSupabaseClient<Database>(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.SUPABASE_SERVICE_ROLE_KEY!,\n    {\n      auth: {\n        autoRefreshToken: false,\n        persistSession: false,\n      },\n    }\n  )\n}\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;AACA;;;;AAGO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IAEjC,OAAO,IAAA,iMAAkB,sUAGvB;QACE,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC5C,YAAY,GAAG,CAAC,MAAM,OAAO;gBAEjC,EAAE,OAAM;gBACN,0DAA0D;gBAC1D,wDAAwD;gBACxD,iBAAiB;gBACnB;YACF;QACF;IACF;AAEJ;AAEO,SAAS;IACd,OAAO,IAAA,gMAAoB,gFAEzB,QAAQ,GAAG,CAAC,yBAAyB,EACrC;QACE,MAAM;YACJ,kBAAkB;YAClB,gBAAgB;QAClB;IACF;AAEJ"}},
    {"offset": {"line": 90, "column": 0}, "map": {"version":3,"sources":["file:///Users/rahmanbazarov/Data/programming/BedRock/src/app/api/auth/complete-registration/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\nimport { createServiceClient } from '@/lib/supabase/server'\n\nexport async function POST(request: Request) {\n  try {\n    const body = await request.json()\n    const { userId, email, fullName, phone, countryOfOrigin, countryOfResidence, trustScore, oauthVerifications } = body\n\n    if (!email || !fullName) {\n      return NextResponse.json({ error: 'Email and full name are required' }, { status: 400 })\n    }\n\n    const supabase = createServiceClient()\n\n    // Find the auth user â€” prefer userId if provided, otherwise look up by email\n    let authUserId = userId\n\n    if (authUserId) {\n      // Verify the user exists\n      const { data: { user }, error } = await supabase.auth.admin.getUserById(authUserId)\n      if (error || !user) {\n        authUserId = null // Fall through to email lookup\n      }\n    }\n\n    if (!authUserId) {\n      // Fallback: find user by email using admin API with page size 1\n      const { data: { users } } = await supabase.auth.admin.listUsers({ page: 1, perPage: 1000 })\n      const authUser = users?.find((u) => u.email === email)\n      if (!authUser) {\n        return NextResponse.json({ error: 'User not found in auth' }, { status: 404 })\n      }\n      authUserId = authUser.id\n    }\n\n    // Check if founder already exists\n    const { data: existingFounder } = await (supabase\n      .from('founders') as ReturnType<typeof supabase.from>)\n      .select('id')\n      .eq('user_id', authUserId)\n      .single()\n\n    if (existingFounder) {\n      return NextResponse.json({ message: 'Founder already exists', founderId: (existingFounder as { id: string }).id })\n    }\n\n    // Create founder record\n    const { data: founder, error: founderError } = await (supabase\n      .from('founders') as ReturnType<typeof supabase.from>)\n      .insert({\n        user_id: authUserId,\n        email,\n        full_name: fullName,\n        phone: phone || null,\n        country_of_origin: countryOfOrigin || '',\n        country_of_residence: countryOfResidence || '',\n        onboarding_completed: !!trustScore,\n      })\n      .select('id')\n      .single()\n\n    if (founderError) {\n      return NextResponse.json({ error: `Founder creation failed: ${founderError.message}` }, { status: 500 })\n    }\n\n    const founderId = (founder as { id: string }).id\n\n    // Save trust score if provided\n    if (trustScore && founderId) {\n      const { error: tsError } = await (supabase.from('trust_scores') as ReturnType<typeof supabase.from>).insert({\n        founder_id: founderId,\n        total_score: trustScore.totalScore || 0,\n        identity_score: trustScore.identityScore || 0,\n        business_score: trustScore.businessScore || 0,\n        financial_score: trustScore.businessScore || 0,\n        social_score: trustScore.networkScore || 0,\n        country_adjustment: trustScore.countryAdjustment || 0,\n        status: trustScore.status || 'review_needed',\n        score_breakdown: trustScore.breakdown || {},\n      })\n\n      if (tsError) {\n        console.error('Trust score insert failed:', tsError.message)\n      }\n    }\n\n    // Save OAuth verifications if provided\n    if (oauthVerifications && founderId) {\n      for (const v of oauthVerifications) {\n        try {\n          await (supabase.from('founder_verifications') as ReturnType<typeof supabase.from>)\n            .upsert({\n              founder_id: founderId,\n              verification_type: v.type,\n              status: 'verified',\n              verified_at: new Date().toISOString(),\n              metadata: v.data,\n            }, { onConflict: 'founder_id,verification_type' })\n        } catch {\n          // Non-critical\n        }\n      }\n    }\n\n    return NextResponse.json({ success: true, founderId })\n  } catch (err) {\n    console.error('complete-registration error:', err)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":"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"}}]
}