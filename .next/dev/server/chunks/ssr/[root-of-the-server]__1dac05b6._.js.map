{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///Users/rahmanbazarov/Data/programming/BedRock/src/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr'\nimport { createClient as createSupabaseClient } from '@supabase/supabase-js'\nimport { cookies } from 'next/headers'\nimport { Database } from '@/types/database'\n\nexport async function createClient() {\n  const cookieStore = await cookies()\n\n  return createServerClient<Database>(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return cookieStore.getAll()\n        },\n        setAll(cookiesToSet) {\n          try {\n            cookiesToSet.forEach(({ name, value, options }) =>\n              cookieStore.set(name, value, options)\n            )\n          } catch {\n            // The `setAll` method was called from a Server Component.\n            // This can be ignored if you have middleware refreshing\n            // user sessions.\n          }\n        },\n      },\n    }\n  )\n}\n\nexport function createServiceClient() {\n  return createSupabaseClient<Database>(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.SUPABASE_SERVICE_ROLE_KEY!,\n    {\n      auth: {\n        autoRefreshToken: false,\n        persistSession: false,\n      },\n    }\n  )\n}\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;AACA;;;;AAGO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,0IAAO;IAEjC,OAAO,IAAA,+LAAkB,sUAGvB;QACE,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC5C,YAAY,GAAG,CAAC,MAAM,OAAO;gBAEjC,EAAE,OAAM;gBACN,0DAA0D;gBAC1D,wDAAwD;gBACxD,iBAAiB;gBACnB;YACF;QACF;IACF;AAEJ;AAEO,SAAS;IACd,OAAO,IAAA,8LAAoB,gFAEzB,QAAQ,GAAG,CAAC,yBAAyB,EACrC;QACE,MAAM;YACJ,kBAAkB;YAClB,gBAAgB;QAClB;IACF;AAEJ"}},
    {"offset": {"line": 66, "column": 0}, "map": {"version":3,"sources":["file:///Users/rahmanbazarov/Data/programming/BedRock/src/app/admin/analytics/page.tsx"],"sourcesContent":["export const dynamic = 'force-dynamic'\n\nimport { createServiceClient } from '@/lib/supabase/server'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { StatsCard } from '@/components/admin'\nimport { Users, Building2, DollarSign, TrendingUp } from 'lucide-react'\n\nexport default async function AnalyticsPage() {\n  const supabase = createServiceClient()\n\n  const [\n    { count: totalFounders },\n    { count: totalCompanies },\n    { data: scores },\n    { data: payments },\n    { data: companiesByState },\n    { data: recentFounders },\n  ] = await Promise.all([\n    supabase.from('founders').select('*', { count: 'exact', head: true }),\n    supabase.from('companies').select('*', { count: 'exact', head: true }),\n    supabase.from('trust_scores').select('total_score, status'),\n    supabase.from('payments').select('amount, status').eq('status', 'completed'),\n    supabase.from('companies').select('state'),\n    supabase.from('founders').select('created_at').order('created_at', { ascending: false }).limit(30),\n  ])\n\n  const allScores = (scores || []) as { total_score: number; status: string }[]\n  const avgScore = allScores.length > 0\n    ? Math.round(allScores.reduce((s, x) => s + x.total_score, 0) / allScores.length)\n    : 0\n\n  const totalRevenue = ((payments || []) as { amount: number }[])\n    .reduce((s, p) => s + p.amount, 0)\n\n  const stateBreakdown = ((companiesByState || []) as { state: string | null }[])\n    .reduce((acc, c) => {\n      const st = c.state || 'Unknown'\n      acc[st] = (acc[st] || 0) + 1\n      return acc\n    }, {} as Record<string, number>)\n\n  const scoreDistribution = [\n    { range: '80-100', count: allScores.filter((s) => s.total_score >= 80).length, color: 'bg-green-500' },\n    { range: '70-79', count: allScores.filter((s) => s.total_score >= 70 && s.total_score < 80).length, color: 'bg-blue-500' },\n    { range: '50-69', count: allScores.filter((s) => s.total_score >= 50 && s.total_score < 70).length, color: 'bg-yellow-500' },\n    { range: '30-49', count: allScores.filter((s) => s.total_score >= 30 && s.total_score < 50).length, color: 'bg-orange-500' },\n    { range: '0-29', count: allScores.filter((s) => s.total_score < 30).length, color: 'bg-red-500' },\n  ]\n\n  const total = allScores.length || 1\n\n  return (\n    <div>\n      <div className=\"mb-8\">\n        <h1 className=\"text-2xl font-bold text-gray-900\">Analytics</h1>\n        <p className=\"mt-1 text-sm text-gray-500\">Platform metrics and insights.</p>\n      </div>\n\n      <div className=\"mb-8 grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4\">\n        <StatsCard title=\"Total Founders\" value={totalFounders || 0} icon={Users} />\n        <StatsCard title=\"Total Companies\" value={totalCompanies || 0} icon={Building2} />\n        <StatsCard title=\"Avg Trust Score\" value={avgScore} icon={TrendingUp} />\n        <StatsCard title=\"Total Revenue\" value={`$${(totalRevenue / 100).toFixed(0)}`} icon={DollarSign} />\n      </div>\n\n      <div className=\"grid grid-cols-1 gap-6 lg:grid-cols-2\">\n        {/* Score Distribution */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Trust Score Distribution</CardTitle>\n            <CardDescription>{allScores.length} scores recorded</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              {scoreDistribution.map((item) => (\n                <div key={item.range} className=\"flex items-center gap-4\">\n                  <div className=\"w-20 text-sm font-medium text-gray-600\">{item.range}</div>\n                  <div className=\"flex-1\">\n                    <div className=\"h-4 rounded-full bg-gray-200\">\n                      <div\n                        className={`h-4 rounded-full ${item.color}`}\n                        style={{ width: `${Math.round((item.count / total) * 100)}%` }}\n                      />\n                    </div>\n                  </div>\n                  <div className=\"w-12 text-right text-sm font-medium text-gray-900\">{item.count}</div>\n                </div>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* State Breakdown */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Companies by State</CardTitle>\n            <CardDescription>Formation state distribution</CardDescription>\n          </CardHeader>\n          <CardContent>\n            {Object.keys(stateBreakdown).length === 0 ? (\n              <p className=\"text-sm text-gray-500\">No companies yet.</p>\n            ) : (\n              <div className=\"space-y-3\">\n                {Object.entries(stateBreakdown)\n                  .sort((a, b) => b[1] - a[1])\n                  .map(([state, count]) => (\n                    <div key={state} className=\"flex items-center justify-between rounded-lg border border-gray-200 p-3\">\n                      <span className=\"font-medium text-gray-900\">\n                        {state === 'DE' ? 'Delaware' : state === 'WY' ? 'Wyoming' : state}\n                      </span>\n                      <span className=\"text-sm font-medium text-gray-600\">{count} companies</span>\n                    </div>\n                  ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Recent Signups */}\n        <Card className=\"lg:col-span-2\">\n          <CardHeader>\n            <CardTitle>Signup Activity (Last 30)</CardTitle>\n            <CardDescription>Recent founder registrations</CardDescription>\n          </CardHeader>\n          <CardContent>\n            {(recentFounders || []).length === 0 ? (\n              <p className=\"text-sm text-gray-500\">No signups yet.</p>\n            ) : (\n              <div className=\"flex h-32 items-end gap-1\">\n                {getLast30DayCounts(recentFounders as { created_at: string }[]).map((count, i) => (\n                  <div key={i} className=\"flex flex-1 flex-col items-center gap-1\">\n                    <div\n                      className=\"w-full rounded-sm bg-blue-500\"\n                      style={{ height: `${Math.max(count * 24, count > 0 ? 8 : 2)}px` }}\n                    />\n                  </div>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  )\n}\n\nfunction getLast30DayCounts(founders: { created_at: string }[]): number[] {\n  const counts = new Array(30).fill(0)\n  const now = new Date()\n  founders.forEach((f) => {\n    const days = Math.floor((now.getTime() - new Date(f.created_at).getTime()) / (1000 * 60 * 60 * 24))\n    if (days >= 0 && days < 30) counts[29 - days]++\n  })\n  return counts\n}\n"],"names":[],"mappings":"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"}}]
}